---
- name: Perform retrieve with provided credentials
  when: data_store.scm.origin.token is defined
  block:
    - name: Retrive the host vars with provided token access
      ansible.scm.git_retrieve:
        origin:
          url: "{{ data_store['scm']['origin']['url'] }}"
          token: "{{ data_store['scm']['origin']['token'] }}"
        parent_directory: "{{ data_store.scm.parent_directory | default(inventory_directory) }}"
      register: result

    - name: Update data store path
      ansible.builtin.set_fact:
        repository: "{{ result }}"

- name: Perform retrieve with default settings
  when: data_store.scm.origin.token is undefined
  block:
    - name: Retrieve host vars with defualt access
      ansible.scm.git_retrieve:
        origin:
          url: "{{ data_store['scm']['origin']['url'] }}"
        parent_directory: "{{ data_store.scm.parent_directory | default(inventory_directory) }}"
      register: result

    - name: Update data store path
      ansible.builtin.set_fact:
        repository: "{{ result }}"

- name: Update Inventory Path
  ansible.builtin.set_fact:
    inventory_path: "{{ repository['path'] }}"
